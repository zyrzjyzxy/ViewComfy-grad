# 侧边栏区分与用户标签页优化方案

## 1. 现状分析

### 1.1 现有侧边栏实现

* **管理员侧边栏**：仅显示管理功能（用户管理、记录管理、统计数据、管理员信息）

* **普通用户侧边栏**：显示用户功能（Apps、Playground、Editor、预设图片、历史记录）

* **问题**：管理员无法访问用户功能，侧边栏逻辑不够灵活

### 1.2 现有用户标签页

* **当前路径**：根路径下的直接标签页（/playground、/editor等）

* **问题**：缺少清晰的用户路径结构，权限控制不够精细

## 2. 侧边栏区分方案

### 2.1 核心设计原则

* **角色清晰**：明确区分管理员和普通用户的功能权限

* **功能完整性**：管理员可访问所有功能，普通用户仅能访问用户功能

* **视觉差异化**：通过颜色、图标等视觉元素区分不同角色的侧边栏

* **灵活性**：支持角色切换时的动态更新

### 2.2 技术实现方案

#### 2.2.1 组件结构修改

```typescript
// components/sidebar.tsx
// 1. 分离侧边栏渲染逻辑
// 2. 实现管理员双重功能访问
// 3. 添加视觉标识
```

#### 2.2.2 功能模块区分

| 功能模块   | 管理员侧边栏 | 普通用户侧边栏 |
| ------ | ------ | ------- |
| 用户管理   | ✅      | ❌       |
| 记录管理   | ✅      | ❌       |
| 统计数据   | ✅      | ❌       |
| 管理员信息  | ✅      | ❌       |
| 编辑器工作台 | ✅（可选）  | ✅       |
| 纹理替换   | ✅（可选）  | ✅       |
| 预设图片   | ✅（可选）  | ✅       |
| 历史记录   | ✅（可选）  | ✅       |
| 用户信息   | ✅（可选）  | ✅       |

#### 2.2.3 视觉区分设计

* **管理员侧边栏**：深色主题（bg-gray-900），白色文字，蓝色高亮

* **普通用户侧边栏**：浅色主题（bg-background），深色文字，绿色高亮

* **角色标识**：在侧边栏顶部显示当前角色

* **功能分组**：明确分组管理功能和用户功能

#### 2.2.4 权限控制逻辑

```typescript
// 基于useAuth hook的角色判断
const isAdmin = user?.role === 'ADMIN';

// 功能项权限控制
const canAccessAdminFeatures = isAdmin;
const canAccessUserFeatures = true; // 所有登录用户可访问
```

## 3. 用户标签页路径重构方案

### 3.1 重构目标

* **清晰的路径结构**：区分管理路径和用户路径

* **精细的权限控制**：基于路径的权限校验

* **更好的SEO和可维护性**：语义化的URL设计

### 3.2 具体路径规划

#### 3.2.1 管理员路径

* `/admin` - 管理后台首页（统计数据）

* `/admin/users` - 用户管理

* `/admin/histories` - 记录管理

* `/admin/profile` - 管理员信息

#### 3.2.2 用户路径

* `/users/editor` - 编辑器工作台

* `/users/playground` - 功能测试区

* `/users/preset-images` - 预设图片管理

* `/users/history` - 历史记录

* `/users/profile` - 用户信息

### 3.3 路由配置方案

#### 3.3.1 路由文件修改

```typescript
// app/[...]/page.tsx 结构调整
// 1. 移动现有用户页面到/users/目录下
// 2. 保持管理页面在/admin/目录下
// 3. 添加重定向规则
```

#### 3.3.2 重定向规则

* `/editor` → `/users/editor`

* `/playground` → `/users/playground`

* `/preset-images` → `/users/preset-images`

* `/history` → `/users/history`

* `/profile` → `/users/profile`

## 4. 相关组件修改范围

### 4.1 主要修改文件

1. **components/sidebar.tsx** - 侧边栏逻辑优化
2. **app/layout.tsx** - 路由结构调整
3. **context/AuthContext.tsx** - 权限逻辑增强
4. **components/admin/AdminRouteGuard.tsx** - 路由保护优化
5. **app/page.tsx** - 首页重定向逻辑

### 4.2 组件修改细节

#### 4.2.1 Sidebar组件

* 实现管理员/普通用户侧边栏的动态切换

* 添加功能分组和视觉标识

* 支持管理员访问用户功能

#### 4.2.2 路由保护

* 更新AdminRouteGuard以支持新的路径结构

* 添加用户路径的权限校验

* 实现动态重定向

#### 4.2.3 导航逻辑

* 更新导航链接以使用新的路径结构

* 实现标签页与路径的映射

* 添加面包屑导航支持

## 5. 权限控制逻辑

### 5.1 前端权限控制

```typescript
// 基于角色的权限判断
const hasPermission = (feature: string) => {
  if (isAdmin) return true;
  return userPermissions.includes(feature);
};

// 侧边栏项渲染控制
{hasPermission('editor') && <SidebarItem ... />}
```

### 5.2 后端权限校验

* 更新API路由的权限中间件

* 确保所有/admin/\*路由都需要管理员权限

* 确保/users/\*路由需要登录权限

## 6. 测试计划

### 6.1 单元测试

* 侧边栏渲染逻辑测试

* 权限判断函数测试

* 路由重定向测试

### 6.2 集成测试

* 管理员登录后侧边栏显示测试

* 普通用户登录后侧边栏显示测试

* 权限越界访问测试

### 6.3 端到端测试

* 完整登录流程测试

* 功能访问权限测试

* 角色切换测试

## 7. 上线策略

### 7.1 灰度发布

* 先在测试环境验证

* 逐步向生产环境推送

* 监控错误率和性能指标

### 7.2 回滚方案

* 保留旧路由的临时支持

* 实现快速回滚机制

* 准备详细的回滚文档

## 8. 预期效果

### 8.1 侧边栏效果

* 管理员可同时访问管理功能和用户功能

* 普通用户仅能访问用户功能

* 清晰的视觉区分和功能分组

### 8.2 用户体验

* 更清晰的导航结构

* 更精细的权限控制

* 更好的路径语义化

### 8.3 技术收益

* 更灵活的侧边栏逻辑

* 更可维护的路由结构

* 更好的权限控制机制

## 9. 实施时间线

1. **需求分析与设计**：已完成
2. **代码实现**：1-2天
3. **测试验证**：1天
4. **灰度发布**：1天
5. **全面上线**：1天

## 10. 风险评估

### 10.1 风险点

* 路由重定向可能导致现有书签失效

* 权限逻辑变更可能影响现有功能

* 侧边栏样式变更可能影响用户体验

### 10.2 缓解措施

* 实现301永久重定向

* 进行全面的回归测试

* 收集用户反馈并及时调整

## 11. 后续优化方向

1. **可配置侧边栏**：允许管理员自定义侧边栏
2. **多级权限系统**：支持更精细的权限控制
3. **响应式优化**：进一步优化移动端侧边栏体验
4. **国际化支持**：添加侧边栏多语言支持

