# 管理员登录问题诊断和修复计划

## 问题分析

**当前问题：**
1. 使用管理员身份登录后，没有跳转到 admin 界面
2. admin 界面显示为空
3. 存在构建错误：`Unexpected token. Did you mean '{'}'` or `&rbrace;`?`

## 诊断步骤

### 步骤 1：添加调试日志
在以下关键位置添加 console.log 来跟踪执行流程：

1. **AuthContext.tsx - login 函数**
   - 记录登录 API 返回的完整数据
   - 记录用户角色
   - 记录跳转逻辑

2. **AdminRouteGuard.tsx**
   - 记录用户状态
   - 记录权限检查逻辑
   - 记录跳转决策

3. **app/admin/page.tsx**
   - 记录统计数据获取过程
   - 记录 stats 状态更新
   - 记录 loading 状态

### 步骤 2：检查数据库
使用 Prisma Studio 或数据库查询工具检查管理员账户的 role 字段是否为 'ADMIN'

### 步骤 3：测试登录 API
使用 Postman 或 curl 测试登录 API，验证返回的用户对象包含正确的 role 字段

### 步骤 4：清除缓存
1. 删除 `.next` 目录
2. 清除浏览器缓存
3. 清除 localStorage 中的 token 和 user 数据

### 步骤 5：验证修复效果
1. 重新启动开发服务器
2. 使用管理员账户登录
3. 检查控制台日志输出
4. 验证是否正确跳转到 /admin
5. 验证 admin 页面是否正确显示数据

## 预期结果

- 通过调试日志可以准确定位问题所在
- 管理员登录后正确跳转到 /admin 页面
- admin 页面正确显示统计数据
- 没有构建错误